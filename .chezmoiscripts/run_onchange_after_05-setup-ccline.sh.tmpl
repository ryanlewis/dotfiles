#!/bin/bash
# Install ccline (Claude Code status line) via npm
# Re-runs when .tool-versions changes (e.g. Node.js version bump)
#
# Version hash: {{ include "dot_tool-versions.tmpl" | sha256sum }}
set -e

# Skip in CI or quick install mode
if [[ "${CI:-}" == "true" ]] || [[ "${QUICK_INSTALL:-}" == "true" ]]; then
    echo "Skipping ccline setup (CI/quick install mode)"
    exit 0
fi

# Ensure mise shims are on PATH (Node.js is installed via mise)
export PATH="$HOME/.local/share/mise/shims:$HOME/.local/bin:$PATH"

# Check if ccline is already available
if command -v ccline &> /dev/null; then
    echo "ccline is already installed"
    exit 0
fi

# Check if npm is available
if ! command -v npm &> /dev/null; then
    echo "npm not found, skipping ccline installation"
    exit 0
fi

echo "Installing ccline via npm..."
npm install -g @cometix/ccline || {
    echo "Failed to install ccline, continuing without it"
    exit 0
}

echo "ccline installed successfully"
